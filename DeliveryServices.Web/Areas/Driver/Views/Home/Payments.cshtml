@model IEnumerable<DeliveryServices.Models.DriverSalaryPayment>
@{
    ViewData["Title"] = "Payment History";
    var totalPaid = Model.Sum(p => p.Amount);
}

@section PageHeader {
    <div class="mb-4">
  <nav aria-label="breadcrumb">
 <ol class="breadcrumb mb-2">
    <li class="breadcrumb-item"><a asp-action="Index">Dashboard</a></li>
             <li class="breadcrumb-item active">Payments</li>
</ol>
        </nav>
     <h1 class="h3 mb-0">Payment History</h1>
     <p class="text-muted mb-0">View your salary payment records</p>
    </div>
}

<!-- Summary Card -->
<div class="card border-0 shadow-sm mb-4">
    <div class="card-body">
   <div class="row g-3">
      <div class="col-md-4">
      <div class="text-center p-3 bg-success bg-opacity-10 rounded">
 <i class="bi bi-cash-stack text-success fs-1"></i>
 <h3 class="mt-2 mb-0 text-success">@totalPaid.ToString("N2")</h3>
      <p class="text-muted mb-0">Total Payments Received</p>
  </div>
      </div>
    <div class="col-md-4">
        <div class="text-center p-3 bg-primary bg-opacity-10 rounded">
   <i class="bi bi-receipt text-primary fs-1"></i>
      <h3 class="mt-2 mb-0 text-primary">@Model.Count()</h3>
   <p class="text-muted mb-0">Number of Payments</p>
      </div>
 </div>
  <div class="col-md-4">
  <div class="text-center p-3 bg-info bg-opacity-10 rounded">
    <i class="bi bi-calculator text-info fs-1"></i>
       <h3 class="mt-2 mb-0 text-info">@(Model.Any() ? (totalPaid / Model.Count()).ToString("N2") : "0.00")</h3>
   <p class="text-muted mb-0">Average Payment</p>
  </div>
            </div>
  </div>
    </div>
</div>

<!-- Payments Table -->
<div class="card border-0 shadow-sm">
    <div class="card-body">
   @if (Model.Any())
   {
       <div class="table-responsive">
      <table class="table table-hover align-middle">
       <thead class="table-light">
<tr>
           <th>Payment Date</th>
   <th>Period</th>
    <th>Deliveries</th>
         <th>Base Salary</th>
   <th>Commission</th>
     <th>Total Amount</th>
    <th>Payment Method</th>
      <th>Processed By</th>
     </tr>
     </thead>
   <tbody>
  @foreach (var payment in Model)
   {
      <tr>
       <td>
       <strong>@payment.PaymentDate.ToString("yyyy/MM/dd")</strong>
          <br />
<small class="text-muted">@payment.PaymentDate.ToString("HH:mm")</small>
    </td>
   <td class="small">
     @payment.PeriodStart.ToString("MMM dd") - @payment.PeriodEnd.ToString("MMM dd, yyyy")
  </td>
    <td class="text-center">
    <span class="badge bg-primary">@payment.DeliveriesCount</span>
 </td>
  <td>@payment.BaseSalaryPortion.ToString("N2")</td>
       <td class="text-success">@payment.CommissionPortion.ToString("N2")</td>
         <td><strong class="text-success">@payment.Amount.ToString("N2")</strong></td>
 <td>
 @if (!string.IsNullOrEmpty(payment.PaymentMethod))
    {
       <span class="badge bg-info">@payment.PaymentMethod</span>
 }
       else
   {
         <span class="text-muted">-</span>
      }
       </td>
     <td class="small text-muted">@payment.ProcessedBy</td>
    </tr>
      @if (!string.IsNullOrEmpty(payment.Notes) || !string.IsNullOrEmpty(payment.TransactionReference))
     {
      <tr class="table-light">
 <td colspan="8" class="small">
       @if (!string.IsNullOrEmpty(payment.TransactionReference))
           {
     <strong>Ref:</strong> @payment.TransactionReference
   <br />
        }
  @if (!string.IsNullOrEmpty(payment.Notes))
    {
     <strong>Notes:</strong> @payment.Notes
      }
    </td>
    </tr>
  }
      }
      </tbody>
  <tfoot class="table-light">
        <tr>
       <td colspan="5" class="text-end"><strong>Total Received:</strong></td>
    <td><strong class="text-success fs-5">@totalPaid.ToString("N2")</strong></td>
       <td colspan="2"></td>
  </tr>
   </tfoot>
       </table>
        </div>
        }
        else
        {
      <div class="text-center py-5 text-secondary">
     <i class="bi bi-inbox display-4"></i>
       <p class="mt-3">No payments received yet</p>
     <a asp-action="Index" class="btn btn-outline-primary mt-2">
    <i class="bi bi-arrow-left"></i> Back to Dashboard
       </a>
      </div>
        }
    </div>
</div>
